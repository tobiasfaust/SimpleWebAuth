Alias /auth /var/www/SimpleWebAuth/public/
Alias /authadmin /var/www/SimpleWebAuth/admin/

<Location /authadmin>
  AddDefaultCharset UTF-8

  RewriteEngine On

  # 1) Hard IP block: only real local subnet allowed
  # This uses REMOTE_ADDR (not X-Forwarded-For) to avoid spoofing via proxies.
  RewriteCond %{REMOTE_ADDR} !^192\.168\.10\.
  RewriteRule ^ - [F]

  # 2) Gate: only on initial request and not for /auth/*
  RewriteCond %{ENV:REDIRECT_STATUS} ^$
  RewriteCond %{REQUEST_URI} !^/auth/
  # Gate anhand der gesetzten Umgebungsvariable
  RewriteCond %{ENV:AUTHRES} !^OK$
  RewriteRule ^ /auth/check.php?return=%{REQUEST_URI} [R=302,L,NE]

  <IfModule mod_authz_core.c>
     <RequireAll>
       Require ip 192.168.10.0/24
     </RequireAll>
  </IfModule>
</Location>